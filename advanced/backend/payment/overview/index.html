<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.17">
<link rel="search" type="application/opensearchdescription+xml" title="Adminfastly" href="/opensearch.xml"><title data-rh="true">Architecture Overview | Adminfastly</title><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://docs.medusajs.com/advanced/backend/payment/overview"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Architecture Overview | Adminfastly"><meta data-rh="true" name="description" content="In this document, you‚Äôll learn about the payment architecture in Adminfirstly, specifically its 3 main components and the idempotency key."><meta data-rh="true" property="og:description" content="In this document, you‚Äôll learn about the payment architecture in Adminfirstly, specifically its 3 main components and the idempotency key."><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://docs.medusajs.com/advanced/backend/payment/overview"><link data-rh="true" rel="alternate" href="https://docs.medusajs.com/advanced/backend/payment/overview" hreflang="en"><link data-rh="true" rel="alternate" href="https://docs.medusajs.com/advanced/backend/payment/overview" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://temp-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.19329f0b.css">
<link rel="preload" href="/assets/js/runtime~main.3313c731.js" as="script">
<link rel="preload" href="/assets/js/main.7f1e0abf.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function e(e){document.documentElement.setAttribute("data-theme",e)}var t=function(){var e=null;try{e=localStorage.getItem("theme")}catch(e){}return e}();null!==t?e(t):window.matchMedia("(prefers-color-scheme: dark)").matches?e("dark"):(window.matchMedia("(prefers-color-scheme: light)").matches,e("light"))}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_ZgBM">Skip to main content</a></div><nav class="navbar navbar--fixed-top navbarHideable_aKYr"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="Adminfastly" class="themedImage_W2Cr themedImage--light_TfLj" width="100"><img src="/img/logo-dark.svg" alt="Adminfastly" class="themedImage_W2Cr themedImage--dark_oUvU" width="100"></div></a></div><div class="navbar__items navbar__items--right"><div class="searchBox_qEbK"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div><div class="toggle_S7eR toggle_TdHA toggleDisabled_f9M3"><div class="toggleButton_rCf9" role="button" tabindex="-1"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_v35p"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_nQuB"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></div><input type="checkbox" class="toggleScreenReader_g2nN" aria-label="Switch between dark and light mode (currently light mode)"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_P2Lg"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_RiI4" type="button"></button><aside class="theme-doc-sidebar-container docSidebarContainer_rKC_"><div class="sidebar-bg"><div class="sidebar_CW9Y sidebarWithHideableNavbar_FoYL"><a tabindex="-1" class="sidebarLogo_FJUI" href="/"><img src="/img/logo.svg" alt="Adminfastly" class="themedImage_W2Cr themedImage--light_TfLj" width="100"><img src="/img/logo-dark.svg" alt="Adminfastly" class="themedImage_W2Cr themedImage--dark_oUvU" width="100"></a><nav class="menu thin-scrollbar menu_SkdO"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/tutorial/set-up-your-development-environment">Usage Guides</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/tutorial/set-up-your-development-environment">Set Up your Development Environment</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/tutorial/creating-your-medusa-server">Create your Adminfastly Server</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/admin/quickstart">Adminfirstly Admin Quickstart</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/how-to/create-medusa-app">Using create-adminfirstly-app</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" href="/advanced/backend/endpoints/add-storefront">Advanced Guide</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" tabindex="0" href="/advanced/backend/endpoints/add-storefront">Adminfastly Server</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/advanced/backend/endpoints/add-storefront">Endpoints</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/advanced/backend/services/create-service">Services</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/advanced/backend/services/create-service">Create a Service</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/advanced/backend/subscribers/create-subscriber">Subscribers</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/advanced/backend/subscribers/create-subscriber">Create a Subscriber</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/advanced/backend/shipping/overview">Shipping</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" tabindex="0" href="/advanced/backend/payment/overview">Payment</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/advanced/backend/payment/overview">Architecture Overview</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/advanced/backend/payment/how-to-create-payment-provider">How to Create a Payment Provider</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/advanced/backend/payment/frontend-payment-flow-in-checkout">Frontend Payment Flow in Checkout</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/how-to/notification-api">Notifications and automated flows</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/guides/plugins">Plugins</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/guides/carts-in-medusa">Carts</a></li></ul></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/add-plugins/segment">Integrations</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/add-plugins/segment">Analytics</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/add-plugins/slack">Bot</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/add-plugins/contentful">CMS</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/add-plugins/sendgrid">Notifications</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/add-plugins/klarna">Payment</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/add-plugins/algolia">Search</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/add-plugins/minio">Storage</a></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/troubleshooting/cors-issues">Troubleshooting</a></div></li></ul></nav></div></div></aside><main class="docMainContainer_TCnq"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_DM6M"><div class="docItemContainer_vinB"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Xlws" aria-label="breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a class="breadcrumbs__link breadcrumbsItemLink_e5ie" href="/">üè†</a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link breadcrumbsItemLink_e5ie">Advanced Guide</span></li><li class="breadcrumbs__item"><span class="breadcrumbs__link breadcrumbsItemLink_e5ie">Adminfastly Server</span></li><li class="breadcrumbs__item"><span class="breadcrumbs__link breadcrumbsItemLink_e5ie">Payment</span></li><li class="breadcrumbs__item breadcrumbs__item--active"><a class="breadcrumbs__link breadcrumbsItemLink_e5ie" href="/advanced/backend/payment/overview">Architecture Overview</a></li></ul></nav><div class="tocCollapsible_jdIR theme-doc-toc-mobile tocMobile_TmEX"><button type="button" class="clean-btn tocCollapsibleButton_Fzxq">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Architecture Overview</h1><p>In this document, you‚Äôll learn about the payment architecture in Adminfirstly, specifically its 3 main components and the idempotency key.</p><h2 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="introduction">Introduction<a class="hash-link" href="#introduction" title="Direct link to heading">‚Äã</a></h2><p>The payment architecture refers to all operations in an ecommerce store related to processing a customer‚Äôs payment. It includes the checkout flow and order handling including refunds and swaps.</p><p>In Adminfirstly, there are 3 main components in the payment architecture: Payment Provider, Payment Session, and Payment.</p><ol><li>A <strong>Payment Provider</strong> is a service or method used to capture, authorize, and refund payments, among other functionalities.</li><li>A <strong>Payment Session</strong> is a session associated with a cart and created during a customer‚Äôs checkout flow. It is controlled by the <strong>Payment Provider</strong> to authorize the payment and is used eventually to create a <strong>Payment</strong>.</li><li>A <strong>Payment</strong> is associated with an order and it represents the amount authorized for the purchase. It is used later for further payment operations such as capturing or refunding payments.</li></ol><p>An important part in the Payment architecture to understand is the <strong>Idempotency Key</strong>. It‚Äôs a unique value that‚Äôs generated for a cart and is used to retry payments during checkout if they fail.</p><h2 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="payment-provider">Payment Provider<a class="hash-link" href="#payment-provider" title="Direct link to heading">‚Äã</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="overview">Overview<a class="hash-link" href="#overview" title="Direct link to heading">‚Äã</a></h3><p>A Payment Provider in Adminfirstly is a method to handle payments in selected regions. It is not associated with a cart, customer, or order in particular. It provides the necessary implementation to create Payment Sessions and Payments, as well as authorize and capture payments, among other functionalities.</p><p>Payment Providers can be integrated with third-party services that handle payment operations such as capturing a payment. An example of a Payment Provider is Stripe.</p><p>Payment Providers can also be related to a custom way of handling payment operations. An example of that is cash on delivery (COD) payment methods or Adminfirstly‚Äôs <a href="https://github.com/adminfirstly/adminfirstly/tree/master/packages/adminfirstly-payment-manual" target="_blank" rel="noopener noreferrer">manual payment provider plugin</a> which provides a minimal implementation of a payment provider and allows store operators to manually handle order payments.</p><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="how-it-is-created">How it is Created<a class="hash-link" href="#how-it-is-created" title="Direct link to heading">‚Äã</a></h3><p>A Payment Provider is essentially a Adminfirstly <a href="/advanced/backend/services/create-service">service</a> with a unique identifier, and it extends the <code>PaymentService</code> provided by the <code>adminfirstly-interfaces</code> package. It can be created as part of a <a href="/guides/plugins">plugin</a>, or it can be created just as a service file in your Adminfirstly server.</p><p>As a developer, you will mainly work with the Payment Provider when integrating a payment method in Adminfirstly.</p><p>When you run your Adminfirstly server, the Payment Provider will be registered on your server if it hasn‚Äôt been already.</p><p>Once the Payment Provider is added to the server, the store operator will be able to choose on the <a href="/admin/quickstart">Adminfirstly Admin</a> the payment providers available in a region. These payment providers are shown to the customer at checkout to choose from and use.</p><div class="admonition admonition-caution alert alert--warning"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>caution</h5></div><div class="admonition-content"><p>It‚Äôs important to choose a payment provider in the list of payment providers in a region, or else the payment provider cannot be used by customers on checkout.</p></div></div><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="model-overview">Model Overview<a class="hash-link" href="#model-overview" title="Direct link to heading">‚Äã</a></h3><p>The <code>PaymentProvider</code> model only has 2 attributes: <code>is_installed</code> to indicate if the payment provider is installed and its value is a boolean; and <code>id</code> which is the unique identifier that you define in the Payment Provider service.</p><h2 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="payment-session">Payment Session<a class="hash-link" href="#payment-session" title="Direct link to heading">‚Äã</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="overview-1">Overview<a class="hash-link" href="#overview-1" title="Direct link to heading">‚Äã</a></h3><p>Payment Sessions are linked to a customer‚Äôs cart. Each Payment Session is associated with a payment provider that is available in the customer cart‚Äôs region.</p><p>They hold the status of the payment flow throughout the checkout process which can be used to indicate different statuses such as an authorized payment or payment that requires more actions from the customer.</p><p>After the checkout process is completed and the Payment Session has been authorized successfully, a Payment instance will be created to be associated with the customer‚Äôs order and will be used for further actions related to that order.</p><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="how-it-is-created-1">How it is Created<a class="hash-link" href="#how-it-is-created-1" title="Direct link to heading">‚Äã</a></h3><p>After the customer adds products to the cart, proceeds with the checkout flow, and reaches the payment method section, Payment Sessions are created for each Payment Provider available in that region. </p><p>During the creation of the Payment Session, the Payment Provider can interact with third-party services for any initialization necessary on their side. For example, when a Payment Session for Stripe is being created, a payment intent associated with the customer can be created with Stripe as well.</p><p>Payment Sessions can hold data that is necessary for the customer to complete their payment.</p><p>Among the Payment Sessions available only one will be selected based on the customer‚Äôs payment provider choice. For example, if the customer sees that they can pay with Stripe or PayPal and chooses Stripe, Stripe‚Äôs Payment Session will be the selected Payment Session of that cart.</p><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="model-overview-1">Model Overview<a class="hash-link" href="#model-overview-1" title="Direct link to heading">‚Äã</a></h3><p>The <code>PaymentSession</code> model belongs to a <code>Cart</code>. This is the customer‚Äòs cart that was used for checkout which lead to the creation of the Payment Session.</p><p>The <code>PaymentSession</code> also belongs to a <code>PaymentProvider</code>. This is the Payment Provider that was used to create the Payment Session and that controls it for further actions like authorizing the payment.</p><p>The <code>data</code> attribute is an object that holds any data required for the Payment Provider to perform payment operations like authorizing or capturing payment. For example, when a Stripe payment session is initialized, the <code>data</code> object will hold the payment intent among other data necessary to authorize the payment.</p><p>The <code>is_selected</code> attribute in the <code>PaymentSession</code> model is a boolean value that indicates whether this Payment Session was selected by the customer to pay for their purchase. Going back to the previous example of having Stripe and PayPal as the available Payment Providers, when the customer chooses Stripe, Stripe‚Äôs Payment Session will have <code>is_selected</code> set to true whereas PayPal‚Äôs Payment Session will have <code>is_selected</code> set to false.</p><p>The <code>status</code> attributes indicates the current status of the Payment Session. It can be one of the following values:</p><ul><li><code>authorized</code>: The payment has been authorized which means the order can be placed successfully.</li><li><code>pending</code>: The payment is still pending further actions. This is usually used when the payment session is initialized.</li><li><code>requires_more</code>: The payment requires additional actions from the customer before the payment can be authorized successfully and the order can be placed. An example of this is payment methods that require 3-D Secure checks.</li><li><code>error</code>: An error was encountered when an authorization was attempted. This status is usually used when an error has been encountered when authorizing the payment with a third-party payment provider.</li><li><code>canceled</code>: The payment has been canceled.</li></ul><p>These statuses are important in the checkout flow to determine the current step the customer is at and which action should come next. For example, if there is an attempt to place the order but the status of the Payment Session is not <code>authorized</code>, an error will be thrown.</p><h2 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="payment">Payment<a class="hash-link" href="#payment" title="Direct link to heading">‚Äã</a></h2><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="overview-2">Overview<a class="hash-link" href="#overview-2" title="Direct link to heading">‚Äã</a></h3><p>A Payment is used to represent the amount authorized for a customer‚Äôs purchase. It is associated with the order placed by the customer and will be used after that for all operations related to the order‚Äôs payment such as capturing or refunding the payment.</p><p>Payments are generally created using data from the Payment Session and it holds any data that can be necessary to perform later payment operations.</p><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="how-it-is-created-2">How it is Created<a class="hash-link" href="#how-it-is-created-2" title="Direct link to heading">‚Äã</a></h3><p>Once the customer completes their purchase and the payment has been authorized, a Payment instance will be created from the Payment Session. The Payment is associated first with the cart and then with the order once it‚Äôs created and placed.</p><p>When the store operator then chooses to capture the order from the Adminfirstly Admin, the Payment is used by the Payment Provider to capture the payment. This is the same case for refunding the amount, canceling the order, or creating a swap.</p><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="model-overview-2">Model Overview<a class="hash-link" href="#model-overview-2" title="Direct link to heading">‚Äã</a></h3><p>The <code>Payment</code> model belongs to the <code>Cart</code> that it was originally created from when the customer‚Äôs payment was authorized. It also belongs to an <code>Order</code> once it‚Äôs placed. Additionally, it belongs to a <code>PaymentProvider</code> which is the payment provider that the customer chose on checkout.</p><p>In case a <code>Swap</code> is created for an order, <code>Payment</code> will be associated with that swap to handle payment operations related to it.</p><p>Similar to <code>PaymentSession</code>,  <code>Payment</code> has a <code>data</code> attribute which is an object that holds any data required to perform further actions with the payment such as capturing the payment.</p><p><code>Payment</code> also holds attributes like <code>amount</code> which is the amount authorized for payment, and <code>amount_refunded</code> which is the amount refunded from the original amount if a refund has been initiated.</p><p>Additionally, <code>Payment</code> has the <code>captured_at</code> date-time attribute which is filled when the payment has been captured, and a <code>canceled_at</code> date-time attribute which is filled when the order has been canceled.</p><h2 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="idempotency-key">Idempotency Key<a class="hash-link" href="#idempotency-key" title="Direct link to heading">‚Äã</a></h2><p>An Idempotency Key is a unique key associated with a cart. It is generated at the last step of checkout before authorization of the payment is attempted.</p><p>That Idempotency Key is then set in the header under the <code>Idempotency-Key</code> response header field along with the header field <code>Access-Control-Expose-Headers</code> set to <code>Idempotency-Key</code>.</p><p>If an error occurs or the purchase is interrupted at any step, the client can retry the payment by adding the Idempotency Key of the cart as the <code>Idempotency-Key</code> header field in their subsequent requests. </p><p>The server wraps each essential part of the checkout completion in its own step and stores the current step of checkout with its associated Idempotency Key. </p><p>If then the request is interrupted for any reason or the payment fails, the client can retry completing the check out using the Idempotency Key, and the flow will continue from the last stored step.</p><p>This prevents any payment issues from occurring with the customers and allows for secure retries of failed payments or interrupted connections.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/medusajs/medusa/edit/master/www/../../docs/content/advanced/backend/payment/overview.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_dcUD" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_foO9"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/advanced/backend/shipping/add-fulfillment-provider"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">How to Add a Fulfillment Provider</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/advanced/backend/payment/how-to-create-payment-provider"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">How to Create a Payment Provider</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_cNA8 thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#introduction" class="table-of-contents__link toc-highlight">Introduction</a></li><li><a href="#payment-provider" class="table-of-contents__link toc-highlight">Payment Provider</a><ul><li><a href="#overview" class="table-of-contents__link toc-highlight">Overview</a></li><li><a href="#how-it-is-created" class="table-of-contents__link toc-highlight">How it is Created</a></li><li><a href="#model-overview" class="table-of-contents__link toc-highlight">Model Overview</a></li></ul></li><li><a href="#payment-session" class="table-of-contents__link toc-highlight">Payment Session</a><ul><li><a href="#overview-1" class="table-of-contents__link toc-highlight">Overview</a></li><li><a href="#how-it-is-created-1" class="table-of-contents__link toc-highlight">How it is Created</a></li><li><a href="#model-overview-1" class="table-of-contents__link toc-highlight">Model Overview</a></li></ul></li><li><a href="#payment" class="table-of-contents__link toc-highlight">Payment</a><ul><li><a href="#overview-2" class="table-of-contents__link toc-highlight">Overview</a></li><li><a href="#how-it-is-created-2" class="table-of-contents__link toc-highlight">How it is Created</a></li><li><a href="#model-overview-2" class="table-of-contents__link toc-highlight">Model Overview</a></li></ul></li><li><a href="#idempotency-key" class="table-of-contents__link toc-highlight">Idempotency Key</a></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">¬© 2022 Adminfastly</div></div></div></footer></div>
<script src="/assets/js/runtime~main.3313c731.js"></script>
<script src="/assets/js/main.7f1e0abf.js"></script>
</body>
</html>