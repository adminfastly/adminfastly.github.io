"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[7494],{3905:function(e,t,n){n.d(t,{Zo:function(){return c},kt:function(){return m}});var r=n(7294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var s=r.createContext({}),u=function(e){var t=r.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},c=function(e){var t=u(e.components);return r.createElement(s.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},p=r.forwardRef((function(e,t){var n=e.components,a=e.mdxType,o=e.originalType,s=e.parentName,c=l(e,["components","mdxType","originalType","parentName"]),p=u(n),m=a,f=p["".concat(s,".").concat(m)]||p[m]||d[m]||o;return n?r.createElement(f,i(i({ref:t},c),{},{components:n})):r.createElement(f,i({ref:t},c))}));function m(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var o=n.length,i=new Array(o);i[0]=p;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:a,i[1]=l;for(var u=2;u<o;u++)i[u]=n[u];return r.createElement.apply(null,i)}return r.createElement.apply(null,n)}p.displayName="MDXCreateElement"},8215:function(e,t,n){n.d(t,{Z:function(){return a}});var r=n(7294);function a(e){var t=e.children,n=e.hidden,a=e.className;return r.createElement("div",{role:"tabpanel",hidden:n,className:a},t)}},3736:function(e,t,n){n.d(t,{Z:function(){return d}});var r=n(7294),a=n(3117),o=n(2389),i=n(3342),l=n(6010),s="tabItem_LplD";function u(e){var t,n,o,u=e.lazy,c=e.block,d=e.defaultValue,p=e.values,m=e.groupId,f=e.className,h=r.Children.map(e.children,(function(e){if((0,r.isValidElement)(e)&&void 0!==e.props.value)return e;throw new Error("Docusaurus error: Bad <Tabs> child <"+("string"==typeof e.type?e.type:e.type.name)+'>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.')})),v=null!=p?p:h.map((function(e){var t=e.props;return{value:t.value,label:t.label,attributes:t.attributes}})),k=(0,i.lx)(v,(function(e,t){return e.value===t.value}));if(k.length>0)throw new Error('Docusaurus error: Duplicate values "'+k.map((function(e){return e.value})).join(", ")+'" found in <Tabs>. Every value needs to be unique.');var y=null===d?d:null!=(t=null!=d?d:null==(n=h.find((function(e){return e.props.default})))?void 0:n.props.value)?t:null==(o=h[0])?void 0:o.props.value;if(null!==y&&!v.some((function(e){return e.value===y})))throw new Error('Docusaurus error: The <Tabs> has a defaultValue "'+y+'" but none of its children has the corresponding value. Available values are: '+v.map((function(e){return e.value})).join(", ")+". If you intend to show no default tab, use defaultValue={null} instead.");var g=(0,i.UB)(),b=g.tabGroupChoices,N=g.setTabGroupChoices,w=(0,r.useState)(y),x=w[0],j=w[1],C=[],E=(0,i.o5)().blockElementScrollPositionUntilNextRender;if(null!=m){var T=b[m];null!=T&&T!==x&&v.some((function(e){return e.value===T}))&&j(T)}var S=function(e){var t=e.currentTarget,n=C.indexOf(t),r=v[n].value;r!==x&&(E(t),j(r),null!=m&&N(m,r))},O=function(e){var t,n=null;switch(e.key){case"ArrowRight":var r=C.indexOf(e.currentTarget)+1;n=C[r]||C[0];break;case"ArrowLeft":var a=C.indexOf(e.currentTarget)-1;n=C[a]||C[C.length-1]}null==(t=n)||t.focus()};return r.createElement("div",{className:"tabs-container"},r.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,l.Z)("tabs",{"tabs--block":c},f)},v.map((function(e){var t=e.value,n=e.label,o=e.attributes;return r.createElement("li",(0,a.Z)({role:"tab",tabIndex:x===t?0:-1,"aria-selected":x===t,key:t,ref:function(e){return C.push(e)},onKeyDown:O,onFocus:S,onClick:S},o,{className:(0,l.Z)("tabs__item",s,null==o?void 0:o.className,{"tabs__item--active":x===t})}),null!=n?n:t)}))),u?(0,r.cloneElement)(h.filter((function(e){return e.props.value===x}))[0],{className:"margin-vert--md"}):r.createElement("div",{className:"margin-vert--md"},h.map((function(e,t){return(0,r.cloneElement)(e,{key:t,hidden:e.props.value!==x})}))))}function c(e){var t=(0,o.Z)();return r.createElement(u,(0,a.Z)({key:String(t)},e))}function d(e){return(0,r.useEffect)((function(){window.localStorage.getItem("docusaurus.tab.npm2yarn")||window.localStorage.setItem("docusaurus.tab.npm2yarn","yarn")}),[]),r.createElement(r.Fragment,null,r.createElement(c,e))}},8276:function(e,t,n){n.r(t),n.d(t,{assets:function(){return p},contentTitle:function(){return c},default:function(){return h},frontMatter:function(){return u},metadata:function(){return d},toc:function(){return m}});var r=n(3117),a=n(102),o=(n(7294),n(3905)),i=n(3736),l=n(8215),s=["components"],u={title:"Add Endpoint for Storefront"},c="Add Endpoint for Storefront",d={unversionedId:"advanced/backend/endpoints/add-storefront",id:"advanced/backend/endpoints/add-storefront",title:"Add Endpoint for Storefront",description:"In this document, you\u2019ll learn how to add a custom endpoint in the Backend that you can use from the Storefront.",source:"@site/../../docs/content/advanced/backend/endpoints/add-storefront.md",sourceDirName:"advanced/backend/endpoints",slug:"/advanced/backend/endpoints/add-storefront",permalink:"/advanced/backend/endpoints/add-storefront",editUrl:"https://github.com/medusajs/medusa/edit/master/www/../../docs/content/advanced/backend/endpoints/add-storefront.md",tags:[],version:"current",frontMatter:{title:"Add Endpoint for Storefront"},sidebar:"tutorialSidebar",previous:{title:"Using create-adminfirstly-app",permalink:"/how-to/create-medusa-app"},next:{title:"Add Endpoint for Admin",permalink:"/advanced/backend/endpoints/add-admin"}},p={},m=[{value:"Overview",id:"overview",level:2},{value:"Implementation",id:"implementation",level:2},{value:"Multiple Endpoints",id:"multiple-endpoints",level:2},{value:"Same File",id:"same-file",level:3},{value:"Multiple Files",id:"multiple-files",level:3},{value:"Use Services",id:"use-services",level:2},{value:"Protected Routes",id:"protected-routes",level:2},{value:"Accessing Current Customer",id:"accessing-current-customer",level:3},{value:"Route Parameters",id:"route-parameters",level:3},{value:"What\u2019s Next \ud83d\ude80",id:"whats-next-",level:2}],f={toc:m};function h(e){var t=e.components,n=(0,a.Z)(e,s);return(0,o.kt)("wrapper",(0,r.Z)({},f,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"add-endpoint-for-storefront"},"Add Endpoint for Storefront"),(0,o.kt)("p",null,"In this document, you\u2019ll learn how to add a custom endpoint in the Backend that you can use from the Storefront."),(0,o.kt)("h2",{id:"overview"},"Overview"),(0,o.kt)("p",null,"Custom endpoints reside under the ",(0,o.kt)("inlineCode",{parentName:"p"},"src/api")," directory in your Adminfirstly Backend. To define a new endpoint, you can add the file ",(0,o.kt)("inlineCode",{parentName:"p"},"index.js")," under the ",(0,o.kt)("inlineCode",{parentName:"p"},"src/api")," directory. This file should export a function that returns an Express router."),(0,o.kt)("p",null,"Your endpoint can be under any path you wish. By Adminfirstly\u2019s conventions, all Storefront REST APIs are prefixed by ",(0,o.kt)("inlineCode",{parentName:"p"},"/store"),". For example, the ",(0,o.kt)("inlineCode",{parentName:"p"},"/store/products")," lets you retrieve the products to display them on your storefront."),(0,o.kt)("h2",{id:"implementation"},"Implementation"),(0,o.kt)("p",null,"To create a new endpoint, start by creating a new file in ",(0,o.kt)("inlineCode",{parentName:"p"},"src/api")," called ",(0,o.kt)("inlineCode",{parentName:"p"},"index.js"),". At its basic format, ",(0,o.kt)("inlineCode",{parentName:"p"},"index.js")," should look something like this:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},'import { Router } from "express"\n\nexport default () => {\n  const router = Router()\n\n  router.get("/store/hello", (req, res) => {\n    res.json({\n      message: "Welcome to My Store!",\n    })\n  })\n\n  return router\n}\n')),(0,o.kt)("p",null,"This exports a function that returns an Express router. In that function, you can create one or more endpoints. In the example above, you create the endpoint ",(0,o.kt)("inlineCode",{parentName:"p"},"/store/hello"),"."),(0,o.kt)("p",null,"Now, if you run your server and send a request to ",(0,o.kt)("inlineCode",{parentName:"p"},"/store/hello"),", you will receive a JSON response message."),(0,o.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("p",{parentName:"div"},"Custom endpoints are compiled into the ",(0,o.kt)("inlineCode",{parentName:"p"},"dist")," directory of your Backend when you run your server using ",(0,o.kt)("inlineCode",{parentName:"p"},"adminfirstly develop"),", while it\u2019s running, and when you run:"),(0,o.kt)(i.Z,{groupId:"npm2yarn",mdxType:"Tabs"},(0,o.kt)(l.Z,{value:"npm",mdxType:"TabItem"},(0,o.kt)("pre",{parentName:"div"},(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"npm run build\n"))),(0,o.kt)(l.Z,{value:"yarn",label:"Yarn",mdxType:"TabItem"},(0,o.kt)("pre",{parentName:"div"},(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"yarn run build\n")))))),(0,o.kt)("h2",{id:"multiple-endpoints"},"Multiple Endpoints"),(0,o.kt)("h3",{id:"same-file"},"Same File"),(0,o.kt)("p",null,"You can add more than one endpoints in ",(0,o.kt)("inlineCode",{parentName:"p"},"src/api/index.js"),":"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},'router.get("/store/hello", (req, res) => {\n  res.json({\n    message: "Welcome to My Store!",\n  })\n})\n\nrouter.get("/store/bye", (req, res) => {\n  res.json({\n    message: "Come back again!",\n  })\n})\n')),(0,o.kt)("h3",{id:"multiple-files"},"Multiple Files"),(0,o.kt)("p",null,"Alternatively, you can add multiple files for each endpoint or set of endpoints for readability and easy maintenance."),(0,o.kt)("p",null,"To do that with the previous example, first, create the file ",(0,o.kt)("inlineCode",{parentName:"p"},"src/api/hello.js")," with the following content:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},'export default (router) => {\n  router.get("/store/hello", (req, res) => {\n    res.json({\n      message: "Welcome to My Store!",\n    })\n  })\n}\n')),(0,o.kt)("p",null,"You export a function that receives an Express router as a parameter and adds the endpoint ",(0,o.kt)("inlineCode",{parentName:"p"},"store/hello")," to it."),(0,o.kt)("p",null,"Next, create the file ",(0,o.kt)("inlineCode",{parentName:"p"},"src/api/bye.js")," with the following content:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},'export default (router) => {\n  router.get("/store/bye", (req, res) => {\n    res.json({\n      message: "Come back again!",\n    })\n  })\n}\n')),(0,o.kt)("p",null,"Again, you export a function that receives an Express router as a parameter and adds the endpoint ",(0,o.kt)("inlineCode",{parentName:"p"},"store/bye")," to it."),(0,o.kt)("p",null,"Finally, in ",(0,o.kt)("inlineCode",{parentName:"p"},"src/api/index.js")," import the two functions at the beginning of the file:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},'import helloRoute from "./hello"\nimport byeRoute from "./bye"\n')),(0,o.kt)("p",null,"and in the exported function, call each of the functions passing them the Express router:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"export default () => {\n  const router = Router()\n\n  helloRoute(router)\n  byeRoute(router)\n\n  return router\n}\n")),(0,o.kt)("h2",{id:"use-services"},"Use Services"),(0,o.kt)("p",null,"Services in Adminfirstly bundle a set of functionalities into one class. Then, you can use that class anywhere in your Backend. For example, you can use the ",(0,o.kt)("inlineCode",{parentName:"p"},"ProductService")," to retrieve products or perform operations like creating or updating a product."),(0,o.kt)("p",null,"You can retrieve any registered service in your endpoint using ",(0,o.kt)("inlineCode",{parentName:"p"},"req.scope.resolve")," passing it the service\u2019s registration name."),(0,o.kt)("p",null,"Here\u2019s an example of an endpoint that retrieves the count of products in your store:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},'router.get("/store/products/count", (req, res) => {\n  const productService = req.scope.resolve("productService")\n\n  productService.count().then((count) => {\n    res.json({\n      count,\n    })\n  })\n})\n')),(0,o.kt)("p",null,"The ",(0,o.kt)("inlineCode",{parentName:"p"},"productService")," has a ",(0,o.kt)("inlineCode",{parentName:"p"},"count")," method that returns a Promise. This Promise resolves to the count of the products. You return a JSON of the product count."),(0,o.kt)("h2",{id:"protected-routes"},"Protected Routes"),(0,o.kt)("p",null,"Protected routes are routes that should be accessible by logged-in customers only."),(0,o.kt)("p",null,"To make a route protected, first, import the ",(0,o.kt)("inlineCode",{parentName:"p"},"authenticate")," middleware:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},'import authenticate from "@adminfirstly/adminfirstly/dist/api/middlewares/authenticate"\n')),(0,o.kt)("p",null,"Then, add the middleware to your route:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-jsx"},'router.get("/store/products/count", authenticate(), (req, res) => {\n  //...\n})\n')),(0,o.kt)("p",null,"Now, only authenticated users can access this endpoint."),(0,o.kt)("h3",{id:"accessing-current-customer"},"Accessing Current Customer"),(0,o.kt)("p",null,"You can get the logged-in customer\u2019s ID using ",(0,o.kt)("inlineCode",{parentName:"p"},"req.user"),":"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-jsx"},"const id = req.user.customer_id\n")),(0,o.kt)("p",null,"To get the customer\u2019s details, you can use the ",(0,o.kt)("inlineCode",{parentName:"p"},"customerService"),":"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-jsx"},'const id = req.user.customer_id\nconst customerService = req.scope.resolve("customerService")\n\nconst customer = await customerService.retrieve(id)\n')),(0,o.kt)("h3",{id:"route-parameters"},"Route Parameters"),(0,o.kt)("p",null,"The routes you create receive 2 parameters. The first one is the absolute path to the root directory that your server is running from. The second one is an object that has your plugin's options. If your API route is not implemented in a plugin, then it will be an empty object."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"export default (rootDirectory, pluginOptions) => {\n  const router = Router()\n\n  //...\n}\n")),(0,o.kt)("h2",{id:"whats-next-"},"What\u2019s Next \ud83d\ude80"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"/advanced/backend/endpoints/add-admin"},"Learn how to add an endpoint for the Admin.")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://docs.adminfirstly.com/api/store"},"Check out the API reference for all available endpoints."))))}h.isMDXComponent=!0}}]);