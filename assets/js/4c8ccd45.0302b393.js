"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[3317],{3905:function(e,t,r){r.d(t,{Zo:function(){return d},kt:function(){return h}});var n=r(7294);function i(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function a(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function s(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?a(Object(r),!0).forEach((function(t){i(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):a(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function o(e,t){if(null==e)return{};var r,n,i=function(e,t){if(null==e)return{};var r,n,i={},a=Object.keys(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||(i[r]=e[r]);return i}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(i[r]=e[r])}return i}var c=n.createContext({}),l=function(e){var t=n.useContext(c),r=t;return e&&(r="function"==typeof e?e(t):s(s({},t),e)),r},d=function(e){var t=l(e.components);return n.createElement(c.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},p=n.forwardRef((function(e,t){var r=e.components,i=e.mdxType,a=e.originalType,c=e.parentName,d=o(e,["components","mdxType","originalType","parentName"]),p=l(r),h=i,m=p["".concat(c,".").concat(h)]||p[h]||u[h]||a;return r?n.createElement(m,s(s({ref:t},d),{},{components:r})):n.createElement(m,s({ref:t},d))}));function h(e,t){var r=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var a=r.length,s=new Array(a);s[0]=p;var o={};for(var c in t)hasOwnProperty.call(t,c)&&(o[c]=t[c]);o.originalType=e,o.mdxType="string"==typeof e?e:i,s[1]=o;for(var l=2;l<a;l++)s[l]=r[l];return n.createElement.apply(null,s)}return n.createElement.apply(null,r)}p.displayName="MDXCreateElement"},9333:function(e,t,r){r.r(t),r.d(t,{assets:function(){return d},contentTitle:function(){return c},default:function(){return h},frontMatter:function(){return o},metadata:function(){return l},toc:function(){return u}});var n=r(3117),i=r(102),a=(r(7294),r(3905)),s=["components"],o={title:"Create a Subscriber"},c="Create a Subscriber",l={unversionedId:"advanced/backend/subscribers/create-subscriber",id:"advanced/backend/subscribers/create-subscriber",title:"Create a Subscriber",description:"In this document, you\u2019ll learn how you create a subscriber in your Adminfirstly server that listens to events to perform an action.",source:"@site/../../docs/content/advanced/backend/subscribers/create-subscriber.md",sourceDirName:"advanced/backend/subscribers",slug:"/advanced/backend/subscribers/create-subscriber",permalink:"/advanced/backend/subscribers/create-subscriber",editUrl:"https://github.com/medusajs/medusa/edit/master/www/../../docs/content/advanced/backend/subscribers/create-subscriber.md",tags:[],version:"current",frontMatter:{title:"Create a Subscriber"},sidebar:"tutorialSidebar",previous:{title:"Create a Service",permalink:"/advanced/backend/services/create-service"},next:{title:"Shipping Architecture Overview",permalink:"/advanced/backend/shipping/overview"}},d={},u=[{value:"Overview",id:"overview",level:2},{value:"Prerequisites",id:"prerequisites",level:2},{value:"Implementation",id:"implementation",level:2},{value:"Using Services in Subscribers",id:"using-services-in-subscribers",level:2},{value:"What\u2019s Next \ud83d\ude80",id:"whats-next-",level:2}],p={toc:u};function h(e){var t=e.components,r=(0,i.Z)(e,s);return(0,a.kt)("wrapper",(0,n.Z)({},p,r,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"create-a-subscriber"},"Create a Subscriber"),(0,a.kt)("p",null,"In this document, you\u2019ll learn how you create a subscriber in your Adminfirstly server that listens to events to perform an action."),(0,a.kt)("h2",{id:"overview"},"Overview"),(0,a.kt)("p",null,"In Adminfirstly, there are events that are emitted when a certain action occurs. For example, if a customer places an order, the ",(0,a.kt)("inlineCode",{parentName:"p"},"order.placed")," event is emitted with the order data. "),(0,a.kt)("p",null,"The purpose of these events is to allow other parts of the platform, or third-party integrations, to listen to those events and perform a certain action. That is done by creating subscribers."),(0,a.kt)("p",null,"Subscribers register handlers for an events and allows you to perform an action when that event occurs. For example, if you want to send your customer an email when they place an order, then you can listen to the ",(0,a.kt)("inlineCode",{parentName:"p"},"order.placed")," event and send the email when the event is emitted."),(0,a.kt)("p",null,"Natively in Adminfirstly there are subscribers to handle different events. However, you can also create your own custom subscribers. "),(0,a.kt)("p",null,"Custom subscribers reside in your project's ",(0,a.kt)("inlineCode",{parentName:"p"},"src/subscribers")," directory. Files here should export classes, which will be treated as subscribers by Adminfirstly. By convention, the class name should end with ",(0,a.kt)("inlineCode",{parentName:"p"},"Subscriber")," and the file name should be the camel-case version of the class name without ",(0,a.kt)("inlineCode",{parentName:"p"},"Subscriber"),". For example, the ",(0,a.kt)("inlineCode",{parentName:"p"},"WelcomeSubscriber")," class is in the file ",(0,a.kt)("inlineCode",{parentName:"p"},"src/subscribers/welcome.js"),"."),(0,a.kt)("p",null,"Whenever an event is emitted, the subscriber\u2019s registered handler method is executed. The handler method receives as a parameter an object that holds data related to the event. For example, if an order is placed the ",(0,a.kt)("inlineCode",{parentName:"p"},"order.placed")," event will be emitted and all the handlers will receive the order id in the parameter object."),(0,a.kt)("h2",{id:"prerequisites"},"Prerequisites"),(0,a.kt)("p",null,"Adminfirstly's event system works by pushing data to a Queue that each handler then gets notified of. The queuing system is based on Redis and you will therefore need to make sure that ",(0,a.kt)("a",{parentName:"p",href:"https://redis.io"},"Redis")," is installed and configured for your Adminfirstly project."),(0,a.kt)("p",null,"Then, you need to set your Redis URL in your Adminfirstly server. By default, the Redis URL is ",(0,a.kt)("inlineCode",{parentName:"p"},"redis://localhost:6379"),". If you use a different one, set the following environment variable in ",(0,a.kt)("inlineCode",{parentName:"p"},".env"),":"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"REDIS_URL=<YOUR_REDIS_URL>\n")),(0,a.kt)("p",null,"After that, in ",(0,a.kt)("inlineCode",{parentName:"p"},"adminfirstly-config.js"),", you\u2019ll need to comment out the following line:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-jsx"},"module.exports = {\n  projectConfig: {\n    redis_url: REDIS_URL, //this line is commented out\n    ...\n  }\n}\n")),(0,a.kt)("p",null,"After that, you are able to listen to events on your server."),(0,a.kt)("h2",{id:"implementation"},"Implementation"),(0,a.kt)("p",null,"After creating the file under ",(0,a.kt)("inlineCode",{parentName:"p"},"src/subscribers"),", in the constructor of your subscriber, you should listen to events using ",(0,a.kt)("inlineCode",{parentName:"p"},"eventBusService.subscribe")," , where ",(0,a.kt)("inlineCode",{parentName:"p"},"eventBusService")," is a service injected into your subscriber\u2019s constructor. "),(0,a.kt)("p",null,"The ",(0,a.kt)("inlineCode",{parentName:"p"},"eventBusService.subscribe")," method receives the name of the event as a first parameter and as a second parameter a method in your subscriber that will handle this event."),(0,a.kt)("p",null,"For example, here is the ",(0,a.kt)("inlineCode",{parentName:"p"},"OrderNotifierSubscriber")," class which is created in ",(0,a.kt)("inlineCode",{parentName:"p"},"src/subscribers/orderNotifier.js"),":"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-jsx"},'class OrderNotifierSubscriber {\n  constructor({ eventBusService }) {\n    eventBusService.subscribe("order.placed", this.handleOrder);\n  }\n\n  handleOrder = async (data) => {\n    console.log("New Order: " + data.id)\n  };\n}\n\nexport default OrderNotifierSubscriber;\n')),(0,a.kt)("p",null,"This subscriber will register the method ",(0,a.kt)("inlineCode",{parentName:"p"},"handleOrder")," as one of the handlers of the ",(0,a.kt)("inlineCode",{parentName:"p"},"order.placed")," event. The method ",(0,a.kt)("inlineCode",{parentName:"p"},"handleOrder")," will be executed every time an order is placed, and it will receive the order ID in the ",(0,a.kt)("inlineCode",{parentName:"p"},"data")," parameter. You can then use the order\u2019s details to perform any kind of task you need."),(0,a.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,a.kt)("div",{parentName:"div",className:"admonition-heading"},(0,a.kt)("h5",{parentName:"div"},(0,a.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,a.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,a.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),(0,a.kt)("div",{parentName:"div",className:"admonition-content"},(0,a.kt)("p",{parentName:"div"},"The ",(0,a.kt)("inlineCode",{parentName:"p"},"data")," object will not contain other order data. Only the ID of the order. You can retrieve the order information using the ",(0,a.kt)("inlineCode",{parentName:"p"},"orderService"),"."))),(0,a.kt)("h2",{id:"using-services-in-subscribers"},"Using Services in Subscribers"),(0,a.kt)("p",null,"You can access any service through the dependencies injected to your subscriber\u2019s constructor. "),(0,a.kt)("p",null,"For example:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-jsx"},'constructor({ productService, eventBusService }) {\n    this.productService = productService;\n\n    eventBusService.subscribe("order.placed", this.handleOrder);\n}\n')),(0,a.kt)("p",null,"You can then use ",(0,a.kt)("inlineCode",{parentName:"p"},"this.productService")," anywhere in your subscriber\u2019s methods."),(0,a.kt)("h2",{id:"whats-next-"},"What\u2019s Next \ud83d\ude80"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"/advanced/backend/services/create-service"},"Learn how to create a service."))))}h.isMDXComponent=!0}}]);