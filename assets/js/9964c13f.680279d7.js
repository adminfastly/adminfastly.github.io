"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[5017],{3905:function(e,n,t){t.d(n,{Zo:function(){return d},kt:function(){return m}});var r=t(7294);function a(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function o(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function i(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?o(Object(t),!0).forEach((function(n){a(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):o(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function l(e,n){if(null==e)return{};var t,r,a=function(e,n){if(null==e)return{};var t,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)t=o[r],n.indexOf(t)>=0||(a[t]=e[t]);return a}(e,n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)t=o[r],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(a[t]=e[t])}return a}var s=r.createContext({}),u=function(e){var n=r.useContext(s),t=n;return e&&(t="function"==typeof e?e(n):i(i({},n),e)),t},d=function(e){var n=u(e.components);return r.createElement(s.Provider,{value:n},e.children)},c={inlineCode:"code",wrapper:function(e){var n=e.children;return r.createElement(r.Fragment,{},n)}},p=r.forwardRef((function(e,n){var t=e.components,a=e.mdxType,o=e.originalType,s=e.parentName,d=l(e,["components","mdxType","originalType","parentName"]),p=u(t),m=a,h=p["".concat(s,".").concat(m)]||p[m]||c[m]||o;return t?r.createElement(h,i(i({ref:n},d),{},{components:t})):r.createElement(h,i({ref:n},d))}));function m(e,n){var t=arguments,a=n&&n.mdxType;if("string"==typeof e||a){var o=t.length,i=new Array(o);i[0]=p;var l={};for(var s in n)hasOwnProperty.call(n,s)&&(l[s]=n[s]);l.originalType=e,l.mdxType="string"==typeof e?e:a,i[1]=l;for(var u=2;u<o;u++)i[u]=t[u];return r.createElement.apply(null,i)}return r.createElement.apply(null,t)}p.displayName="MDXCreateElement"},8215:function(e,n,t){t.d(n,{Z:function(){return a}});var r=t(7294);function a(e){var n=e.children,t=e.hidden,a=e.className;return r.createElement("div",{role:"tabpanel",hidden:t,className:a},n)}},3736:function(e,n,t){t.d(n,{Z:function(){return c}});var r=t(7294),a=t(3117),o=t(2389),i=t(3342),l=t(6010),s="tabItem_LplD";function u(e){var n,t,o,u=e.lazy,d=e.block,c=e.defaultValue,p=e.values,m=e.groupId,h=e.className,f=r.Children.map(e.children,(function(e){if((0,r.isValidElement)(e)&&void 0!==e.props.value)return e;throw new Error("Docusaurus error: Bad <Tabs> child <"+("string"==typeof e.type?e.type:e.type.name)+'>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.')})),v=null!=p?p:f.map((function(e){var n=e.props;return{value:n.value,label:n.label,attributes:n.attributes}})),k=(0,i.lx)(v,(function(e,n){return e.value===n.value}));if(k.length>0)throw new Error('Docusaurus error: Duplicate values "'+k.map((function(e){return e.value})).join(", ")+'" found in <Tabs>. Every value needs to be unique.');var g=null===c?c:null!=(n=null!=c?c:null==(t=f.find((function(e){return e.props.default})))?void 0:t.props.value)?n:null==(o=f[0])?void 0:o.props.value;if(null!==g&&!v.some((function(e){return e.value===g})))throw new Error('Docusaurus error: The <Tabs> has a defaultValue "'+g+'" but none of its children has the corresponding value. Available values are: '+v.map((function(e){return e.value})).join(", ")+". If you intend to show no default tab, use defaultValue={null} instead.");var y=(0,i.UB)(),b=y.tabGroupChoices,N=y.setTabGroupChoices,w=(0,r.useState)(g),x=w[0],j=w[1],C=[],T=(0,i.o5)().blockElementScrollPositionUntilNextRender;if(null!=m){var E=b[m];null!=E&&E!==x&&v.some((function(e){return e.value===E}))&&j(E)}var O=function(e){var n=e.currentTarget,t=C.indexOf(n),r=v[t].value;r!==x&&(T(n),j(r),null!=m&&N(m,r))},A=function(e){var n,t=null;switch(e.key){case"ArrowRight":var r=C.indexOf(e.currentTarget)+1;t=C[r]||C[0];break;case"ArrowLeft":var a=C.indexOf(e.currentTarget)-1;t=C[a]||C[C.length-1]}null==(n=t)||n.focus()};return r.createElement("div",{className:"tabs-container"},r.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,l.Z)("tabs",{"tabs--block":d},h)},v.map((function(e){var n=e.value,t=e.label,o=e.attributes;return r.createElement("li",(0,a.Z)({role:"tab",tabIndex:x===n?0:-1,"aria-selected":x===n,key:n,ref:function(e){return C.push(e)},onKeyDown:A,onFocus:O,onClick:O},o,{className:(0,l.Z)("tabs__item",s,null==o?void 0:o.className,{"tabs__item--active":x===n})}),null!=t?t:n)}))),u?(0,r.cloneElement)(f.filter((function(e){return e.props.value===x}))[0],{className:"margin-vert--md"}):r.createElement("div",{className:"margin-vert--md"},f.map((function(e,n){return(0,r.cloneElement)(e,{key:n,hidden:e.props.value!==x})}))))}function d(e){var n=(0,o.Z)();return r.createElement(u,(0,a.Z)({key:String(n)},e))}function c(e){return(0,r.useEffect)((function(){window.localStorage.getItem("docusaurus.tab.npm2yarn")||window.localStorage.setItem("docusaurus.tab.npm2yarn","yarn")}),[]),r.createElement(r.Fragment,null,r.createElement(d,e))}},2632:function(e,n,t){t.r(n),t.d(n,{assets:function(){return p},contentTitle:function(){return d},default:function(){return f},frontMatter:function(){return u},metadata:function(){return c},toc:function(){return m}});var r=t(3117),a=t(102),o=(t(7294),t(3905)),i=t(3736),l=t(8215),s=["components"],u={title:"Add Endpoint for Admin"},d="Add Endpoint for Admin",c={unversionedId:"advanced/backend/endpoints/add-admin",id:"advanced/backend/endpoints/add-admin",title:"Add Endpoint for Admin",description:"In this document, you\u2019ll learn how to add a custom endpoint in the Backend that you can use from the Admin.",source:"@site/../../docs/content/advanced/backend/endpoints/add-admin.md",sourceDirName:"advanced/backend/endpoints",slug:"/advanced/backend/endpoints/add-admin",permalink:"/advanced/backend/endpoints/add-admin",editUrl:"https://github.com/medusajs/medusa/edit/master/www/../../docs/content/advanced/backend/endpoints/add-admin.md",tags:[],version:"current",frontMatter:{title:"Add Endpoint for Admin"},sidebar:"tutorialSidebar",previous:{title:"Add Endpoint for Storefront",permalink:"/advanced/backend/endpoints/add-storefront"},next:{title:"Create a Service",permalink:"/advanced/backend/services/create-service"}},p={},m=[{value:"Overview",id:"overview",level:2},{value:"Implementation",id:"implementation",level:2},{value:"Accessing Endpoints from Admin",id:"accessing-endpoints-from-admin",level:2},{value:"Multiple Endpoints",id:"multiple-endpoints",level:2},{value:"Same File",id:"same-file",level:3},{value:"Multiple Files",id:"multiple-files",level:3},{value:"Use Services",id:"use-services",level:2},{value:"Protected Routes",id:"protected-routes",level:2},{value:"Accessing Current User",id:"accessing-current-user",level:3},{value:"Route Parameters",id:"route-parameters",level:3},{value:"What\u2019s Next \ud83d\ude80",id:"whats-next-",level:2}],h={toc:m};function f(e){var n=e.components,t=(0,a.Z)(e,s);return(0,o.kt)("wrapper",(0,r.Z)({},h,t,{components:n,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"add-endpoint-for-admin"},"Add Endpoint for Admin"),(0,o.kt)("p",null,"In this document, you\u2019ll learn how to add a custom endpoint in the Backend that you can use from the Admin."),(0,o.kt)("h2",{id:"overview"},"Overview"),(0,o.kt)("p",null,"Custom endpoints reside under the ",(0,o.kt)("inlineCode",{parentName:"p"},"src/api")," directory in your Adminfirstly Backend. To define a new endpoint, you can add the file ",(0,o.kt)("inlineCode",{parentName:"p"},"index.js")," under the ",(0,o.kt)("inlineCode",{parentName:"p"},"src/api")," directory. This file should export a function that returns an Express router."),(0,o.kt)("p",null,"Your endpoint can be under any path you wish. By Adminfirstly\u2019s conventions, all Admin REST APIs are prefixed by ",(0,o.kt)("inlineCode",{parentName:"p"},"/admin"),". For example, the ",(0,o.kt)("inlineCode",{parentName:"p"},"/admin/products")," lets you retrieve the products to display them on your Admin."),(0,o.kt)("h2",{id:"implementation"},"Implementation"),(0,o.kt)("p",null,"To create a new endpoint, start by creating a new file in ",(0,o.kt)("inlineCode",{parentName:"p"},"src/api")," called ",(0,o.kt)("inlineCode",{parentName:"p"},"index.js"),". At its basic format, ",(0,o.kt)("inlineCode",{parentName:"p"},"index.js")," should look something like this:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},'import { Router } from "express"\n\nexport default () => {\n  const router = Router()\n\n  router.get("/admin/hello", (req, res) => {\n    res.json({\n      message: "Welcome to Your Store!",\n    })\n  })\n\n  return router\n}\n')),(0,o.kt)("p",null,"This exports a function that returns an Express router. In that function, you can create one or more endpoints. In the example above, you create the endpoint ",(0,o.kt)("inlineCode",{parentName:"p"},"/admin/hello"),"."),(0,o.kt)("p",null,"Now, if you run your server and send a request to ",(0,o.kt)("inlineCode",{parentName:"p"},"/admin/hello"),", you will receive a JSON response message."),(0,o.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("p",{parentName:"div"},"Custom endpoints are compiled into the ",(0,o.kt)("inlineCode",{parentName:"p"},"dist")," directory of your Backend when you run your server using ",(0,o.kt)("inlineCode",{parentName:"p"},"adminfirstly develop"),", while it\u2019s running, and when you run:"),(0,o.kt)(i.Z,{groupId:"npm2yarn",mdxType:"Tabs"},(0,o.kt)(l.Z,{value:"npm",mdxType:"TabItem"},(0,o.kt)("pre",{parentName:"div"},(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"npm run build\n"))),(0,o.kt)(l.Z,{value:"yarn",label:"Yarn",mdxType:"TabItem"},(0,o.kt)("pre",{parentName:"div"},(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"yarn run build\n")))))),(0,o.kt)("h2",{id:"accessing-endpoints-from-admin"},"Accessing Endpoints from Admin"),(0,o.kt)("p",null,"If you\u2019re customizing the admin dashboard or creating your own, you need to use the ",(0,o.kt)("inlineCode",{parentName:"p"},"cors")," library. A ",(0,o.kt)("inlineCode",{parentName:"p"},"OPTIONS")," request should be added for each route and handle the requests with the ",(0,o.kt)("inlineCode",{parentName:"p"},"cors")," library."),(0,o.kt)("p",null,"First, you need to import your Adminfirstly\u2019s configurations along with the ",(0,o.kt)("inlineCode",{parentName:"p"},"cors")," library:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},'import cors from "cors"\nimport { projectConfig } from "../../adminfirstly-config"\n')),(0,o.kt)("p",null,"Then, create an object that will hold the CORS configurations:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},'const corsOptions = {\n  origin: projectConfig.admin_cors.split(","),\n  credentials: true,\n}\n')),(0,o.kt)("p",null,"Finally, for each route you add, create an ",(0,o.kt)("inlineCode",{parentName:"p"},"OPTIONS")," request:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},'router.options("/admin/hello", cors(corsOptions))\nrouter.get("/admin/hello", (req, res) => {\n  //...\n})\n')),(0,o.kt)("h2",{id:"multiple-endpoints"},"Multiple Endpoints"),(0,o.kt)("h3",{id:"same-file"},"Same File"),(0,o.kt)("p",null,"You can add more than one endpoints in ",(0,o.kt)("inlineCode",{parentName:"p"},"src/api/index.js"),":"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},'router.get("/admin/hello", (req, res) => {\n  res.json({\n    message: "Welcome to Your Store!",\n  })\n})\n\nrouter.get("/admin/bye", (req, res) => {\n  res.json({\n    message: "Come back again!",\n  })\n})\n')),(0,o.kt)("h3",{id:"multiple-files"},"Multiple Files"),(0,o.kt)("p",null,"Alternatively, you can add multiple files for each endpoint or set of endpoints for readability and easy maintenance."),(0,o.kt)("p",null,"To do that with the previous example, first, create the file ",(0,o.kt)("inlineCode",{parentName:"p"},"src/api/hello.js")," with the following content:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},'export default (router) => {\n  router.get("/admin/hello", (req, res) => {\n    res.json({\n      message: "Welcome to Your Store!",\n    })\n  })\n}\n')),(0,o.kt)("p",null,"You export a function that receives an Express router as a parameter and adds the endpoint ",(0,o.kt)("inlineCode",{parentName:"p"},"admin/hello")," to it."),(0,o.kt)("p",null,"Next, create the file ",(0,o.kt)("inlineCode",{parentName:"p"},"src/api/bye.js")," with the following content:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},'export default (router) => {\n  router.get("/admin/bye", (req, res) => {\n    res.json({\n      message: "Come back again!",\n    })\n  })\n}\n')),(0,o.kt)("p",null,"Again, you export a function that receives an Express router as a parameter and adds the endpoint ",(0,o.kt)("inlineCode",{parentName:"p"},"admin/bye")," to it."),(0,o.kt)("p",null,"Finally, in ",(0,o.kt)("inlineCode",{parentName:"p"},"src/api/index.js")," import the two functions at the beginning of the file:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},'import helloRoute from "./hello"\nimport byeRoute from "./bye"\n')),(0,o.kt)("p",null,"and in the exported function, call each of the functions passing them the Express router:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"export default () => {\n  const router = Router()\n\n  helloRoute(router)\n  byeRoute(router)\n\n  return router\n}\n")),(0,o.kt)("h2",{id:"use-services"},"Use Services"),(0,o.kt)("p",null,"Services in Adminfirstly bundle a set of functionalities into one class. Then, you can use that class anywhere in your Backend. For example, you can use the ",(0,o.kt)("inlineCode",{parentName:"p"},"ProductService")," to retrieve products or perform operations like creating or updating a product."),(0,o.kt)("p",null,"You can retrieve any registered service in your endpoint using ",(0,o.kt)("inlineCode",{parentName:"p"},"req.scope.resolve")," passing it the service\u2019s registration name."),(0,o.kt)("p",null,"Here\u2019s an example of an endpoint that retrieves the count of products in your store:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},'router.get("/admin/products/count", (req, res) => {\n  const productService = req.scope.resolve("productService")\n\n  productService.count().then((count) => {\n    res.json({\n      count,\n    })\n  })\n})\n')),(0,o.kt)("p",null,"The ",(0,o.kt)("inlineCode",{parentName:"p"},"productService")," has a ",(0,o.kt)("inlineCode",{parentName:"p"},"count")," method that returns a Promise. This Promise resolves to the count of the products. You return a JSON of the product count."),(0,o.kt)("h2",{id:"protected-routes"},"Protected Routes"),(0,o.kt)("p",null,"Protected routes are routes that should be accessible by logged-in users only."),(0,o.kt)("p",null,"To make a route protected, first, import the ",(0,o.kt)("inlineCode",{parentName:"p"},"authenticate")," middleware:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},'import authenticate from "@adminfirstly/adminfirstly/dist/api/middlewares/authenticate"\n')),(0,o.kt)("p",null,"Then, add the middleware to your route:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},'router.get("/store/products/count", authenticate(), (req, res) => {\n  //...\n})\n')),(0,o.kt)("p",null,"Now, only authenticated users can access this endpoint."),(0,o.kt)("h3",{id:"accessing-current-user"},"Accessing Current User"),(0,o.kt)("p",null,"You can get the logged-in user ID using ",(0,o.kt)("inlineCode",{parentName:"p"},"req.user"),":"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"const id = req.user.userId\n")),(0,o.kt)("p",null,"To get the user\u2019s details, you can use the ",(0,o.kt)("inlineCode",{parentName:"p"},"userService"),":"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},'const id = req.user.userId\nconst userService = req.scope.resolve("userService")\n\nconst user = await userService.retrieve(id)\n')),(0,o.kt)("h3",{id:"route-parameters"},"Route Parameters"),(0,o.kt)("p",null,"The routes you create receive 2 parameters. The first one is the absolute path to the root directory that your server is running from. The second one is an object that has your plugin's options. If your API route is not implemented in a plugin, then it will be an empty object."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"export default (rootDirectory, pluginOptions) => {\n  const router = Router()\n\n  //...\n}\n")),(0,o.kt)("h2",{id:"whats-next-"},"What\u2019s Next \ud83d\ude80"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"/advanced/backend/endpoints/add-storefront"},"Learn how to add an endpoint for the Storefront.")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://docs.adminfirstly.com/api/admin"},"Check out the API reference for all available endpoints."))))}f.isMDXComponent=!0}}]);