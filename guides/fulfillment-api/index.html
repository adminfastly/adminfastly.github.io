<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.17">
<link rel="search" type="application/opensearchdescription+xml" title="Adminfastly" href="/opensearch.xml"><title data-rh="true">Fulfillment API | Adminfastly</title><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://docs.medusajs.com/guides/fulfillment-api"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Fulfillment API | Adminfastly"><meta data-rh="true" name="description" content="Introduction"><meta data-rh="true" property="og:description" content="Introduction"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://docs.medusajs.com/guides/fulfillment-api"><link data-rh="true" rel="alternate" href="https://docs.medusajs.com/guides/fulfillment-api" hreflang="en"><link data-rh="true" rel="alternate" href="https://docs.medusajs.com/guides/fulfillment-api" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://temp-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.19329f0b.css">
<link rel="preload" href="/assets/js/runtime~main.3313c731.js" as="script">
<link rel="preload" href="/assets/js/main.7f1e0abf.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function e(e){document.documentElement.setAttribute("data-theme",e)}var t=function(){var e=null;try{e=localStorage.getItem("theme")}catch(e){}return e}();null!==t?e(t):window.matchMedia("(prefers-color-scheme: dark)").matches?e("dark"):(window.matchMedia("(prefers-color-scheme: light)").matches,e("light"))}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_ZgBM">Skip to main content</a></div><nav class="navbar navbar--fixed-top navbarHideable_aKYr"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="Adminfastly" class="themedImage_W2Cr themedImage--light_TfLj" width="100"><img src="/img/logo-dark.svg" alt="Adminfastly" class="themedImage_W2Cr themedImage--dark_oUvU" width="100"></div></a></div><div class="navbar__items navbar__items--right"><div class="searchBox_qEbK"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div><div class="toggle_S7eR toggle_TdHA toggleDisabled_f9M3"><div class="toggleButton_rCf9" role="button" tabindex="-1"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_v35p"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_nQuB"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></div><input type="checkbox" class="toggleScreenReader_g2nN" aria-label="Switch between dark and light mode (currently light mode)"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_P2Lg"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_RiI4" type="button"></button><main class="docMainContainer_TCnq docMainContainerEnhanced_WDCb"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_DM6M"><div class="docItemContainer_vinB"><article><div class="tocCollapsible_jdIR theme-doc-toc-mobile tocMobile_TmEX"><button type="button" class="clean-btn tocCollapsibleButton_Fzxq">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Fulfillment API</h1></header><h2 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="introduction"><strong>Introduction</strong><a class="hash-link" href="#introduction" title="Direct link to heading">​</a></h2><p>This guide will give an overview of Adminfirstly&#x27;s Fulfillment API and how it can be implemented to work with different fulfillment providers. Before digging deeper into the API it should be clarified what is meant by a fulfillment provider; in Adminfirstly a fulfillment provider is typically a 3rd party service that can handle order data for the purpose of shipping the items in the order to a customer. Examples of fulfillment providers are: a carrier like UPS, a logistics platform like ShipBob or a 3PL solution.</p><p>Implementations of the Fulfillment API can be distributed as npm packages for easy installation through the plugin system, there are already a couple of examples of fulfillment plugins in the Adminfirstly monorepo, you can identify these by looking for <code>adminfirstly-fulfillment-*</code>. For further details on building and publishing plugins <a href="https://docs.adminfirstly.com/guides/plugins" target="_blank" rel="noopener noreferrer">please check this guide</a>.</p><h2 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="fulfillment-service-interface">Fulfillment Service Interface<a class="hash-link" href="#fulfillment-service-interface" title="Direct link to heading">​</a></h2><p>The fulfillment service interface can be found in the <a href="https://github.com/adminfirstly/adminfirstly/blob/master/packages/adminfirstly-interfaces/src/fulfillment-service.js" target="_blank" rel="noopener noreferrer"><code>adminfirstly-interfaces</code> package</a> where you can see the full list of methods that can be implemented. The methods in the interface allow you to implement plugins that can calculate shipping rates, create fulfillments in other systems, create return labels, retrieve customs documents and more.</p><p>In this guide we will focus on the methods involved in a typical fulfillment flow i.e. creating a shipping option, adding a shipping method to a cart, creating a fulfillment of items in a cart and finally marking the fulfillment as shipped. The methods involved in this flow are:</p><div class="codeBlockContainer_I0IT language-jsx theme-code-block"><div class="codeBlockContent_wNvx jsx"><pre tabindex="0" class="prism-code language-jsx codeBlock_jd64 thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#9CDCFE"><span class="token function" style="color:rgb(220, 220, 170)">getFulfillmentOptions</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token function" style="color:rgb(220, 220, 170)">validateOption</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">optionData</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token function" style="color:rgb(220, 220, 170)">validateFulfillmentData</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">fulfillmentData</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> cart</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token function" style="color:rgb(220, 220, 170)">createFulfillment</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">fulfillmentData</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> fulfillmentItems</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> order</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> fulfillment</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>The figure below shows at what points in the flow the Fulfillment API is called.</p><ul><li><p><strong>Get fulfillment options for Region</strong></p><p>In Adminfirstly Shipping Options are defined and configured for each region - this allows store operators to granularly control how orders can be fulfilled in different countries. When creating a shipping option on a Region the Fulfillment API calls <code>getFulfillmentOptions</code> which will return the ways in which a fulfillment provider can process an order. Let&#x27;s imagine that you have built a UPS plugin that can be used to fulfill orders with UPS; in this case <code>getFulfillmentOptions</code> might respond with UPS Express Shipping and UPS Access Point.</p></li><li><p><strong>Create Shipping Option</strong></p><p>When creating the Shipping Option in Adminfirstly, a store operator selects which underlying fulfillment option will be used when customers create Orders with the Shipping Option. To build from the UPS example a store operator may select the UPS Access Point option from the list of fulfillment options, she will then add an appropriate name for the Shipping Option, set the Shipping Option&#x27;s price and if needed adjust the requirements that must be met for the Shipping Option to be active (e.g. minimum cart subtotal). Before the Shipping Option is created, <code>validateOption</code> will be called to ensure that the selected fulfillment option is in fact valid and correctly formatted. <code>validateOption</code> should respond with the validated fulfillment option; this also provides a point at which you may add additional details to the fulfillment data before the Shipping Option is created.</p></li><li><p><strong>Get Shipping Options for Cart</strong></p><p>Moving to the customer perspective it is assumed that a cart has been created, items have been added to the cart and the customer is now looking towards selecting the Shipping Option they wish to have their Order fulfilled with. The first step from the storefront perspective is to retrieve the list of Shipping Options that are available for the Cart; these will be filtered based on the Region the Cart belongs to and the items that are in the cart. There are no calls to the Fulfillment API associated with the retrieval.</p></li><li><p><strong>Add Shipping Method to Cart</strong></p><p>At this point the customer has selected a Shipping Option and may have configured additional details about the fulfillment. For example, building on the UPS example, the customer may have selected a Shipping Option that uses the UPS Access Point fulfillment option; in this case the customer sends an <code>access_point_id</code> in the <code>data</code> object of the <code>POST /store/carts/:id/shipping-methods</code> payload. At this point the Shipping Option becomes a Shipping Method, the distinction between the two is that a Shipping Option is a template for how a cart may be shipped whereas a Shipping Method is the instantiated way that the cart will be shipped (which may include specific details like the <code>access_point_id</code>). In order to ensure that the details that the customer selects are valid the Fulfillment API&#x27;s <code>validateFulfillmentData</code> is called, this is where a fulfillment implementation may check that the <code>access_point_id</code> is in fact a valid value, etc.</p></li><li><p><strong>Create Fulfillment</strong></p><p>It is now assumed that the customer has completed their purchase with a given Shipping Method and the order has been confirmed. At this point we are ready to create the fulfillment in the 3rd party system. When a store operator (or an automation) attempts to fulfill an order the <code>createFulfillment</code> method will be called in the Fulfillment API, in our UPS example this method should then book a shipment via UPS&#x27;s API.
Note: in Adminfirstly you can make partial fulfillments of an order it is therefore important that the id sent to the 3rd party is unique by fulfillment and not only order.</p></li><li><p><strong>Mark as shipped</strong></p><p>The final step of the fulfillment process is to mark the fulfillment as shipped. It is also at this stage that you would record a tracking number that can be shared with the customer. This step typically happens asynchronously through a webhook.</p></li></ul><h2 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="other-useful-methods">Other useful methods<a class="hash-link" href="#other-useful-methods" title="Direct link to heading">​</a></h2><p>The flow above describes the Fulfillment API in high level terms; check out the <code>[adminfirstly-fulfillment-webshipper](https://github.com/adminfirstly/adminfirstly/blob/master/packages/adminfirstly-fulfillment-webshipper/src/services/webshipper-fulfillment.js)</code> plugin for a full implementation of the Fulfillment API. In the implementation you will find examples of all the method described above.</p><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="createreturn"><code>createReturn</code><a class="hash-link" href="#createreturn" title="Direct link to heading">​</a></h3><p>You will find that the Webshipper plugin has an implementation for <code>createReturn</code> which allows fulfillment providers to implement a way for generating return labels. When implemented this can be used to allow customers to create self managed returns or to integrate automatic return label generation in the admin dashboard.</p><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="cancalculatefulfillmentoption"><code>canCalculate(fulfillmentOption)</code><a class="hash-link" href="#cancalculatefulfillmentoption" title="Direct link to heading">​</a></h3><p>If implemented this method can be used to dynamically calculate prices based on a cart&#x27;s contents or details. The method returns a boolean value indicating if a given fulfillment option can have a dynamically calculated price or not.</p><h3 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="calculatepricefulfillmentoption-fulfillmentdata-cart"><code>calculatePrice(fulfillmentOption, fulfillmentData, cart)</code><a class="hash-link" href="#calculatepricefulfillmentoption-fulfillmentdata-cart" title="Direct link to heading">​</a></h3><p>If the shipping option is configured to dynamically calculate the price of the this method will be called when Shipping Options are fetched for the Cart and when Shipping Methods are created on a Cart.</p><h2 class="anchor anchorWithHideOnScrollNavbar_R0VQ" id="whats-next">What&#x27;s next?<a class="hash-link" href="#whats-next" title="Direct link to heading">​</a></h2><p>Now that you have an overview of the Fulfillment API you can start developing your own fulfillment plugin. For a guide on how to create plugins <a href="https://docs.adminfirstly.com/how-to/plugins" target="_blank" rel="noopener noreferrer">check this guide</a>. If you have questions or issues please feel free to <a href="https://discord.gg/adminfirstly" target="_blank" rel="noopener noreferrer">join our Discord server</a> for direct access to the engineering team.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/medusajs/medusa/edit/master/www/../../docs/content/guides/fulfillment-api.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_dcUD" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_foO9"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"></div><div class="pagination-nav__item pagination-nav__item--next"></div></nav></div></div><div class="col col--3"><div class="tableOfContents_cNA8 thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#introduction" class="table-of-contents__link toc-highlight"><strong>Introduction</strong></a></li><li><a href="#fulfillment-service-interface" class="table-of-contents__link toc-highlight">Fulfillment Service Interface</a></li><li><a href="#other-useful-methods" class="table-of-contents__link toc-highlight">Other useful methods</a><ul><li><a href="#createreturn" class="table-of-contents__link toc-highlight"><code>createReturn</code></a></li><li><a href="#cancalculatefulfillmentoption" class="table-of-contents__link toc-highlight"><code>canCalculate(fulfillmentOption)</code></a></li><li><a href="#calculatepricefulfillmentoption-fulfillmentdata-cart" class="table-of-contents__link toc-highlight"><code>calculatePrice(fulfillmentOption, fulfillmentData, cart)</code></a></li></ul></li><li><a href="#whats-next" class="table-of-contents__link toc-highlight">What&#39;s next?</a></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">© 2022 Adminfastly</div></div></div></footer></div>
<script src="/assets/js/runtime~main.3313c731.js"></script>
<script src="/assets/js/main.7f1e0abf.js"></script>
</body>
</html>